{% load custom_tags2 %}

{% if user.is_authenticated and user|is_librarian %}


{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Librarian</title>
    <link rel="icon" href={% static "playground/school_Logo.png" %}>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">


    <style>
        /* Custom styles for the tabs to avoid conflicts */
        .custom-tabs {
            /* Add your custom styles here if needed */
        }

        .custom-nav-item {
            /* Custom styles for nav items */
        }

        .custom-nav-link {
            /* Custom styles for nav links */
            font-weight: bold; /* Example custom style */
            color: #007bff; /* Example custom style */
            text-decoration: none; /* Remove underline */
        }

        .custom-nav-link.active {
            background-color: #e9ecef; /* Change the background for active tab */
            color: #343a40; /* Change the text color for active tab */
        }

        .custom-nav-link:hover {
            background-color: rgba(0, 123, 255, 0.1); /* Change hover background color */
        }

        
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .main-container{
            display: grid;
            grid-template-columns: 250px 1fr;
            grid-template-rows: 1fr;
            grid-template-areas:
            "side-bar content";
            padding: 0px;
        }
        .side-bar{
            grid-area: side-bar;
        }
        .main-content {
            grid-area: content;
            padding-top: 4rem;
            transition: margin-left 0.5s;
        }
        .navbar-brand {
            font-weight: bold;
        }
        .navbar-nav .nav-item .nav-link {
            font-weight: bold;
        }
        .content {
            padding: 20px;
            margin-bottom: 80px;
            margin-right: 45px;
            background-color: #ffffff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
        .btn-danger, .btn-primary {
            font-weight: bold;
        }
        .modal-body {
            font-size: 16px;
        }
        .modal-footer {
            justify-content: space-between;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        img.book-image {
            max-width: 100px;
            height: auto;
        }
        .btn {
            font-weight: bold;
            border-radius: 5px;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }
        .btn-primary, .btn-danger, .btn-secondary {
            position: relative;
        }
        .btn-primary::after, .btn-danger::after, .btn-secondary::after, {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: inherit;
            background-color: rgba(255, 255, 255, 0.2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .btn-primary:hover::after, .btn-danger:hover::after, .btn-secondary:hover::after {
            opacity: 1;
        }
        .btn-primary:hover {
            background-color: #007bff;
            border-color: #007bff;
            color: #fff;
            transform: scale(1.05);
        }
        .btn-danger:hover {
            background-color: #dc3545;
            border-color: #dc3545;
            color: #fff;
            transform: scale(1.05);
        }
        .btn-success:hover{
            background-color: green;
            border-color: green;
            color: #fff;
            transform: scale(1.05);
        }
        .btn-secondary:hover {
            background-color: #6c757d;
            border-color: #6c757d;
            color: #fff;
            transform: scale(1.05);
        }
        .sidebar {
            position: fixed;
            width: auto;
            top:0;
            bottom: 0;
            z-index: 100;
            padding-top: 30px;
            background-color: rgb(74, 128, 210);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: margin-left 0.5s;
            color: white;
            display: flex;
            justify-content: space-between;
            min-height: 100vh;
        }
        .sidebar-sticky {
            position: sticky;
            top: 0;
            height: 100%;
            
        }
        .sidebar .nav-link {
            padding: 0.5rem 1rem;
            color: white;
            font-weight: bold;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        .sidebar .nav-link i {
            margin-right: 0.5rem;
        }
        .sidebar .nav-link.active {
            background-color: #007bff;
            color: #fff;
        }
        .logo {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }
        .navbar-text {
            color: white;
            font-weight: bold;
        }
        .navbar-text:hover{
            border-radius:10px;
            border: 2px solid transparent;
            background-color: rgba(255, 255, 255, 0.1);
            transition: background-color 0.3s ease;
            padding: 5px 10px 5px 10px;
        }
        .nav-item {
            display: flex;
            align-items: center;
            text-align: center;
            padding-top: 10px;
            padding-left: 10px;
            gap: 5px;
        }
        .nav-link {
            display: flex;
            align-items: center;
            margin-top:10px;
            width: 100%;
        }
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .header-lib{
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav{
            display: flex;
            flex-direction: column;
            align-items: cneter;
            height: 90%;
            font-size: 1rem;
        }
        .bottom-nav{
            display: flex;
            flex-shrink: 1;
            margin-top: auto;
            margin-bottom: 20px;
            gap: 20px;
            justify-content: center;
            align-items: center;
        }
        .logo{
            display: flex;
            justify-content: center;
            align-item: center;
        }
        .logout {
            display: flex;
            flex-shrink: 1;
            text-align: center;
            font-size: 1.2rem;
        }
        .navbar-icon, .navbar-icon1{
            font-size: 2rem;
            vertical-align: middle;
        }
        .lib_img{
            min-width: 100px;
            max-width: 100px;
        }
        .delete-btn{
            font-size: 1.2rem;
        }
        .table th {
            background-color: #f8f9fa;
            color: #343a40;
            border-bottom: 2px solid #dee2e6;
        }
        
        .table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .table tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }
        
        .table tbody tr:hover {
            background-color: #e9ecef;
        }
    
        .table th {
            padding: 12px;
        }
        
        .table th:first-child,
        .table td:first-child {
            border-left:  1px solid #dee2e6;
        }
        
        .table th:last-child,
        .table td:last-child {
            border-right: none;
        }
        th, td{
            text-align: center;
            font-weight:1.2rem;
        }
       td{
            text-transform: capitalize;
            text-wrap: wrap;
            overflow: auto;
            max-width: 300px;
        }
        .btn {
            padding: 6px 12px;
            margin: 4px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
            color: #ffffff;
        }
        
        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
            color: #ffffff;
        }
        
        .modal-content {
            border-radius: 8px;
        }
        .sections{
            text-align: center;
        }
        .margin{
            margin-top: 50px;
        }
        .home-lib{
            padding-left: 20px;
            font-size: 1.2rem;
        }
        .lib-ol{
            padding-left: 20px;
        }
        .checkbox{
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        .checkbox-text{
            margin-top: 10px;
            border: 1px solid rgb(74, 128, 210); 
            border-radius: 10px;
            color: white;
            background-color: rgb(74, 128, 210);
            padding: 10px 20px;
            font-weight: bold;
        }
        .bottom-row-text{
            display: flex;
            justify-content: center;
            align-items: center
            text-align: center
        }
        .form-control-file{
            width: auto;
            margin-left: 10px;
        }
        .no-margin{
            margin:0;
            line-height: 1.9;
        }
        .upload{
            width: 100%;
            padding: 20px 0;
            margin-top: 10px;
            border: 1px solid rgb(74, 128, 210); 
            border-radius: 10px;
            color: white;
            background-color: rgb(74, 128, 210);
            padding: 10px 20px;
            font-weight: bold;
            font-size: 2rem;
        }
        .upload:hover{
            background-color: #5E8DD4;
        }
        .restore-delete{
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 1;
        }
        .restore-delete-more{
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            align-items: center;
            flex-shrink: 1;
        }
        .table1{
            margin-bottom: 50px;
        }
        .lib-img{
            min-width:300px;
            max-width:300px;
            min-height:500px;
            max-height:500px;
        }
        .margin-top{
            margin-top: 75px;
        }

                /* Modal background */
        .modal-bg {

            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0, 0, 0, 0.5); /* Black background with opacity */
        }

        /* Modal content box */
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto; /* 10% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            max-width: 600px; /* Maximum width */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.3s ease-out;
        }

        /* Close button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        /* Modal body */
        #modalBody {
            padding: 10px 0;
            font-size: 16px;
            line-height: 1.5;
            color: #333;
        }
        .lib-img-container{
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        .search-bar{
            display:flex;
            justify-content: center;
            align-items: center;
            padding-top: 30px;
        }
        .read-btn{
            background-color: rgb(74, 128, 210);
            border: 1px solid transparent;
            border-radius: 10px;
            padding: 5px 10px;
            color: white;
        }
        .read-btn:hover{
            background-color: rgba(74, 128, 210, .8);
        }
        .hide{
            display: none;
        }
         .info-container{
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            max-width: 1400px;
         }
         .read-more-body{
            display: flex;
         }
         .read-more-bookInfo{
            display: flex;
            justify-content: center;
            align-items: center;
         }
         .more-book-title{
            font-size: 1.7rem;
         }
         .center-item{
            display:flex;
            justify-content: center;
            align-items: center;
         }
        .archive-btn{
            width: 150px;
            height: 60px;
        }
        .info-btn{
            background-color: rgb(74, 128, 210);
            border: transparent;
        }
        .info-btn:hover{
            background-color: rgba(74, 128, 210, .7);
        }
        #bookStatusTabContent .tab-pane .lib-img {
            width: 30px !important;  /* Force width to 30px */
            height: auto !important;  /* Maintain aspect ratio */
        }
    
        .hidden {
            display: none;
        }
    
        .border-transparent {
            border-color: transparent;
        }
    
        .active {
            color: #1d4ed8 !important; /* Ensure the active tab text is blue */
            border-bottom-color: #1d4ed8 !important; /* Ensure the active tab has a blue underline */
            font-weight: bold; /* Make the active tab font bold */
        }
    
        #bookStatusTabs a {
            font-weight: bold; /* Make the tab font bold */
            font-size: 1.1em; /* Increase the font size */
        }
    
        #bookStatusTabs a:hover {
            color: #1d4ed8 !important; /* Ensure the hover text is blue */
        }
          
          
        
        th {
            font-weight: bold; /* Change 'normal' to the desired font weight */
        }

        tr {
            font-weight: normal; /* Ensure tr elements have normal font weight */
        }
    </style>
    {% block style %}{% endblock %}
</head>
<body>
    <div class="container-fluid main-container">
        <div class="side-bar">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-sticky">
                    <div class="logo">
                        <a href="{% url 'librarian' %}"> <img src="{% static 'playground/Logo.png' %}" alt="Logo" style="height: 80px" id="logo"></a>
                    </div>
                    <ul class="nav">
                        <a class="nav-link" href="javascript:void(0);" onclick="showContent('home')">
                            <li class="nav-item"><span class="material-symbols-outlined navbar-icon" alt="home">home</span>Home</li>
                        </a>
                        <a class="nav-link" href="javascript:void(0);" onclick="showContent('upload')">
                            <li class="nav-item"><span class="material-symbols-outlined navbar-icon" alt="upload">upload</span>Upload</li>
                        </a>
                        <a class="nav-link" href="javascript:void(0);" onclick="showContent('books')">
                            <li class="nav-item"><span class="material-symbols-outlined navbar-icon" alt="books">book_4</span>Books</li>
                        </a>
                        <a class="nav-link" href="javascript:void(0);" onclick="showContent('book-status')">
                            <li class="nav-item"><span class="material-symbols-outlined navbar-icon" alt="book-status">library_books</span>Book Status</li>
                        </a>
                        <a class="nav-link" href="javascript:void(0);" onclick="showContent('borrow-req')">
                            <li class="nav-item"><span class="material-symbols-outlined navbar-icon1" alt="borrow-req">menu_book</span>Borrow Requests</li>
                        </a>
                        <a class="nav-link" href="javascript:void(0);" onclick="showContent('recent-delete')">
                            <li class="nav-item"><span class="material-symbols-outlined navbar-icon1" alt="recent-delete">archive</span>Archive</li>
                        </a>
                        <div class="bottom-nav">
                            <a href="{% url 'logout_user' %}" class="btn logout">
                                <li class="logout"><span class="material-symbols-outlined navbar-icon navbar-text" alt="home">logout</span></li>
                            </a> 
                        </div>     
                    </ul>
                </div>
            </div>
        </div>
        <main role="main" class="main-content">
            <div id="home" class="content home-lib" style="display: block;">
                <!-- Welcome Banner -->
                <div class="bg-blue-500 text-white p-5 rounded-lg shadow-md mb-4 text-center">
                    <h1 class="text-4xl font-bold mb-2">Welcome, Librarian!</h1>
                    <p class="text-lg">Manage your library efficiently with our easy-to-use system.</p>
                </div>
            
                <!-- Statistics Section -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-center mb-6">
                    <!-- Total Books -->
                    <div class="bg-green-500 text-white p-4 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
                        <h4 class="font-bold text-2xl mb-2">{{ total_books }}</h4>
                        <p class="text-sm">Total Books in Library</p>
                    </div>
                    <!-- Borrow Requests -->
                    <div class="bg-yellow-500 text-white p-4 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
                        <h4 class="font-bold text-2xl mb-2">{{ pending_borrow_requests }}</h4>
                        <p class="text-sm">Pending Borrow Requests</p>
                    </div>
                    <!-- Recently Added Books -->
                    <div class="bg-blue-500 text-white p-4 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
                        <h4 class="font-bold text-2xl mb-2">{{ books_added_this_month }}</h4>
                        <p class="text-sm">Books Added This Month</p>
                    </div>
                    <!-- Deleted Books -->
                    <div class="bg-red-500 text-white p-4 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
                        <h4 class="font-bold text-2xl mb-2">{{ recently_deleted_books_count }}</h4>
                        <p class="text-sm">Recently Deleted Books</p>
                    </div>
                </div>
            
                <!-- Key Features Section -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-center mt-6">
                    <!-- Upload Books Feature -->
                    <div class="bg-white p-4 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
                        <span class="material-symbols-outlined text-5xl text-blue-500 mb-3">upload</span>
                        <h4 class="font-bold text-lg mb-2">Upload Books</h4>
                        <p class="text-sm text-gray-700 mb-3">Add new books to the library, including title, author, category, and more.</p>
                        <a href="javascript:void(0);" onclick="showContent('upload')" class="text-blue-500 font-bold hover:text-blue-700">Start Uploading</a>
                    </div>
            
                    <!-- View Books Feature -->
                    <div class="bg-white p-4 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
                        <span class="material-symbols-outlined text-5xl text-blue-500 mb-3">book</span>
                        <h4 class="font-bold text-lg mb-2">View Books</h4>
                        <p class="text-sm text-gray-700 mb-3">Browse and manage all the books available in the library system.</p>
                        <a href="javascript:void(0);" onclick="showContent('books')" class="text-blue-500 font-bold hover:text-blue-700">View All Books</a>
                    </div>
            
                    <!-- Borrow Requests Feature -->
                    <div class="bg-white p-4 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
                        <span class="material-symbols-outlined text-5xl text-blue-500 mb-3">menu_book</span>
                        <h4 class="font-bold text-lg mb-2">Borrow Requests</h4>
                        <p class="text-sm text-gray-700 mb-3">Approve or decline book borrow requests from library users.</p>
                        <a href="javascript:void(0);" onclick="showContent('borrow-req')" class="text-blue-500 font-bold hover:text-blue-700">Manage Requests</a>
                    </div>
            
                    <!-- Recently Deleted Feature -->
                    <div class="bg-white p-4 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
                        <span class="material-symbols-outlined text-5xl text-blue-500 mb-3">archive</span>
                        <h4 class="font-bold text-lg mb-2">Recently Deleted</h4>
                        <p class="text-sm text-gray-700 mb-3">Restore or permanently delete books recently removed from the system.</p>
                        <a href="javascript:void(0);" onclick="showContent('recent-delete')" class="text-blue-500 font-bold hover:text-blue-700">View Deleted Books</a>
                    </div>
                </div>
            </div>

            <!-- Upload Section-->
            <div id="upload" class="content" style="display: none;">
                {% if messages %}
                {% for message in messages %}
                    {% if message.tags == 'success' %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    {% elif message.tags == 'error' %}
                        <div class="alert alert-danger">
                            <ul class="mb-0">
                                <li>{{ message }}</li>
                            </ul>
                        </div>
                    {% endif %}
                {% endfor %}
                {% endif %}
                <h1 class="mt-4">Upload</h1>
                <hr>
                <form id="uploadForm" method="post" enctype="multipart/form-data" action="{% url 'librarian' %}">
                    {% csrf_token %}
                    <div class="row">
                        <div class="form-group col">
                            <label for="id_BookTitle">Title:</label>
                            <input type="text" class="form-control" id="id_BookTitle" name="BookTitle" required>
                        </div>
                        <div class="form-group col">
                            <label for="id_Author">Author:</label>
                            <input type="text" class="form-control" id="id_Author" name="Author" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="id_Description">Description:</label>
                        <input type="text" class="form-control" id="id_Description" name="Description" required>
                    </div>
                    <div class="row">
                        <div class="form-group col">
                            <label for="id_Date">Date:</label>
                            <input type="date" class="form-control" id="id_Date" name="Date" required>
                        </div>
                        <div class="form-group col">
                            <label for="id_stock">Stock:</label>
                            <input type="number" class="form-control" id="id_stock" name="stock">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col">
                            <label for="id_Category">Category:</label>
                            <select class="form-control" id="id_Category" name="Category" required>
                                <option value="">Select a category</option>
                                {% for category in categories %}
                                    <option value="{{ category.id }}">{{ category.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group col">
                            <label for="id_Subcategories">SubCategory:</label>
                            <select class="form-control" id="id_Subcategories" name="SubCategory" required>
                                <option value="">Select a subcategory</option>
                                {% for subcategory in subcategories %}
                                    <option value="{{ subcategory.id }}" data-category-id="{{ subcategory.category_id }}">{{ subcategory.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group col">
                            <label for="id_Subsection">SubSection:</label>
                            <select class="form-control" id="id_Subsection" name="SubSection" required>
                                <option value="">Select a subsection</option>
                                {% for subsection in subsections %}
                                    <option value="{{ subsection.id }}" data-section-id="{{ subsection.sub_category_id }}">{{ subsection.name }}</option>
                                {% endfor %}
                            </select>
                        </div>    
                    </div> 
                    <div class="checkbox">
                        <div class="form-group">
                            <div class="checkbox-text">
                                <label for="id_eBook" class="no-margin">Ebook:</label>
                                <input type="checkbox" name="eBook" id="id_eBook">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="checkbox-text">
                                <label for="id_research_paper" class="no-margin">Research Paper:</label>
                                <input type="checkbox" name="research_paper" id="id_research_paper">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="checkbox-text">
                                <label for="id_hardCopy" class="no-margin">HardCopy:</label>
                                <input type="checkbox" name="hardCopy" id="id_hardCopy">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="id_Language">Language:</label>
                        <select class="form-control" id="id_Language" name="Language" required>
                            {% for language in language_choices %}
                                <option value="{{ language.0 }}">{{ language.1 }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="row">
                        <div class="form-group bottom-row-text col">
                            <label for="id_BookFile" class="no-margin">Book File(PDF): </label>
                            <input type="file" class="form-control-file" id="id_BookFile" name="BookFile" required>
                        </div>
                        <div class="form-group bottom-row-text col">
                            <label for="id_BookImage" class="no-margin">Book Image(JPG): </label>
                            <input type="file" class="form-control-file" id="id_BookImage" name="BookImage" required>
                        </div>
                    </div>
                    <button type="submit" class="upload" id="uploadButton">Upload</button>
                </form>
            </div>
            
            <!-- Loading Modal -->
            <div class="modal fade" id="loadingModal" tabindex="-1" role="dialog" aria-labelledby="loadingModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-body text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                            <p>Please wait while your file is being uploaded...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <script>
                document.getElementById('uploadForm').addEventListener('submit', function(event) {
                    const uploadButton = document.getElementById('uploadButton');
                    
                    // Disable the upload button
                    uploadButton.disabled = true;
                    
                    // Show the loading modal
                    $('#loadingModal').modal({
                        backdrop: 'static',
                        keyboard: false,
                        show: true
                    });
                });
            </script>
            <!-- Books Section -->
            <div id="books" class="content book-section" style="display: none;">
                
                <div class="header-lib">
                    <h1 class="mt-4">Books</h1>
                </div>
                <hr>

                <!-- Search and Filter Form -->
                <form id="searchFilterForm" method="get" action="{% url 'librarian' %}">
                    <div class="row">
                        <div class="col-md-2 mb-3">
                            <label for="yearFilter">Search a Book</label>
                            <input type="text" class="form-control" id="searchQuery" name="search" placeholder="Search by Title or Author">
                        </div>
                        <div class="col-md-2 mb-3">
                            <label for="yearFilter">Year</label>
                            <select class="form-control" id="yearFilter" name="year">
                                <option value="">All Years</option>
                                {% for year in years %}
                                    <option value="{{ year }}" {% if request.GET.year == year|stringformat:"s" %}selected{% endif %}>{{ year }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2 mb-3">
                            <label for="languageFilter">Language</label>
                            <select class="form-control" id="languageFilter" name="language">
                                <option value="">All Languages</option>
                                {% for code, name in language_choices %}
                                    <option value="{{ code }}" {% if request.GET.language == code %}selected{% endif %}>{{ name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2 mb-3">
                            <label for="fileTypeFilter">File Type</label>
                            <select class="form-control" id="fileTypeFilter" name="file_type">
                                <option value="">All Types</option>
                                <option value="eBook" {% if request.GET.file_type == "eBook" %}selected{% endif %}>eBook</option>
                                <option value="Research Paper" {% if request.GET.file_type == "Research Paper" %}selected{% endif %}>Research Paper</option>
                            </select>
                        </div>
                        <div class="col-md-2 mb-3">
                            <label for="categoryFilter">Category</label>
                            <select class="form-control" id="categoryFilter" name="category">
                                <option value="">All Categories</option>
                                {% for category in categories %}
                                    <option value="{{ category.name }}" {% if request.GET.category == category.name %}selected{% endif %}>{{ category.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end mb-3">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-search"></i> <!-- Search icon -->
                            </button>
                        </div>
                        <div class="col-md-2 d-flex align-items-end mb-3">
                            <a href="{% url 'reset_filters' %}" class="btn btn-secondary w-100">
                                <i class="fas fa-undo"></i> <!-- Reset icon -->
                            </a>
                        </div>
                    </div>
                </form>

                <hr>
                
                <table class="table table-bordered table-striped" style="width: 100%; text-align: center;">
                    <thead class="thead-light">
                        <tr>
                            <th>Title</th>
                            <th>Author</th>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Dewey Decimal</th>
                            <th>Language</th>
                            <th>File Type</th>
                            <th>Stock</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if books %}
                            {% for book in books %}
                                <tr>
                                    <td class="over-flow">{{ book.BookTitle }}</td>
                                    <td>{{ book.Author }}</td>
                                    <td>{{ book.Date }}</td>
                                    <td>
                                        {% for category in book.Category.all %}
                                            {{ category.name }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </td>
                                    <td>
                                        {% for subsection in book.SubSection.all %}
                                            {{ subsection.code }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </td>
                                    <td>{{ book.Language }}</td>
                                    <td>{{ book.get_file_type }}</td>
                                    <td>{{ book.stock }}</td>
                                    <td>
                                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#viewBookModal-{{ book.id }}">
                                            <i class="fas fa-eye"></i> <!-- Eye icon for viewing -->
                                        </button>
                                        
                                        <a href="{% url 'edit_book' book.id %}" class="btn btn-warning" target="_blank">
                                            <i class="fas fa-edit"></i> <!-- Edit icon -->
                                        </a>
                                        
                                        <form id="deleteFormBook-{{ book.id }}" method="post" action="{% url 'delete_book' book.id %}" style="display: inline;">
                                            {% csrf_token %}
                                            <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteModalBook" 
                                                    data-bookid="{{ book.id }}" data-booktitle="{{ book.BookTitle }}">
                                                <i class="fas fa-archive"></i> <!-- Archive icon -->
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                
                                <!-- Modal for Viewing Book Details -->
                                <div class="modal fade" id="viewBookModal-{{ book.id }}" tabindex="-1" role="dialog" aria-labelledby="viewBookModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-lg" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="viewBookModalLabel">{{ book.BookTitle }}</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row">
                                                    <!-- Book Image on the left side with larger size -->
                                                    <div class="col-md-5 d-flex align-items-center justify-content-center">
                                                        {% if book.BookImage %}
                                                            <img src="{{ book.BookImage.url }}" alt="{{ book.BookTitle }} Image" class="img-fluid" style="max-width: 100%; height: auto; max-height: 400px; object-fit: cover;">
                                                        {% else %}
                                                            <p>No image available</p>
                                                        {% endif %}
                                                    </div>

                                                    <!-- Book Details on the right side -->
                                                    <div class="col-md-7">
                                                        <div class="book-details">
                                                            <p><strong>Author:</strong> {{ book.Author }}</p>
                                                            <p><strong>Date:</strong> {{ book.Date }}</p>
                                                            <p><strong>Description:</strong> {{ book.Description }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="9">No books found.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>

                <!-- Modal for Delete Books -->
                <div class="modal fade" id="deleteModalBook" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="deleteModalLabel"><b>Archive Book?</b></h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                This action cannot be reversed
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-danger" id="confirmDeleteBtnBook">Archive</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Book Status Section -->
            <div id="book-status" class="content hidden">
                <h2 class="sections">Book Status</h2>
                <hr>
                <!-- Flex container for dropdown and search bar -->
                <div class="d-flex align-items-center mb-3">
                    <!-- Dropdown for Book Status Sections -->
                    <div class="dropdown mr-2">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="bookStatusDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Books to be Borrowed
                        </button>
                        <div class="dropdown-menu" aria-labelledby="bookStatusDropdown">
                            <a class="dropdown-item" href="#borrowed" onclick="showBookStatusTab(event, 'borrowed', 'Books to be Borrowed')">Books to be Borrowed</a>
                            <a class="dropdown-item" href="#returned" onclick="showBookStatusTab(event, 'returned', 'Books to be Returned')">Books to be Returned</a>
                            <a class="dropdown-item" href="#logs" onclick="showBookStatusTab(event, 'logs', 'Logs')">Logs</a>
                        </div>
                    </div>
                    <!-- Search Field -->
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchRequests" placeholder="Search Books to be Borrowed" onkeyup="filterRequests()">
                        <div class="input-group-append">
                            <span class="input-group-text" id="search-addon"><i class="fas fa-search"></i></span>
                        </div>
                    </div>
                </div>
            
                <!--Books to be borrowed-->
                <div class="tab-content" id="bookStatusTabContent">
                    <div class="tab-pane fade show active" id="borrowed" role="tabpanel" aria-labelledby="borrowed-tab">
                        <table class="table" id="borrowedTable">
                            <thead>
                                <tr>
                                    <th>Borrowed by</th>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>File Type</th>
                                    <th>Expires at</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for request in book_status_approved_requests %}
                                <tr data-title="{{ request.book.BookTitle }}" data-author="{{ request.book.Author }}">
                                    <td>{{ request.requested_by }}</td>
                                    <td>{{ request.book.BookTitle }}</td>
                                    <td>{{ request.book.Author }}</td>
                                    <td>
                                        {% if request.book.eBook %}
                                            eBook
                                        {% elif request.book.research_paper %}
                                            Research Paper
                                        {% else %}
                                            Unknown
                                        {% endif %}
                                    </td>
                                    <td>{{ request.expireTime }}</td>
                                    <td>
                                        <!-- Adjusted logic to check stock properly -->
                                        <button type="button" 
                                                class="btn {% if request.book.stock > 0 %}btn-success{% else %}btn-secondary{% endif %}" 
                                                {% if request.book.stock == 0 %}disabled{% endif %} 
                                                data-toggle="modal" data-target="#statusModal{{ request.id }}">
                                            {% if request.inOut %}TO CLAIM{% else %}TO RETURN{% endif %}
                                        </button>
            
                                        <button type="button" 
                                                class="btn btn-info" 
                                                onclick="viewBookDetails('{{ request.book.BookImage.url }}', '{{ request.book.BookTitle }}', '{{ request.book.Description }}')">
                                            View
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
            
                    <!--Books to be returned-->
                    <div class="tab-pane fade" id="returned" role="tabpanel" aria-labelledby="returned-tab">
                        <table class="table" id="returnedTable">
                            <thead>
                                <tr>
                                    <th>Borrowed by</th>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>Return Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for out in book_status_books_to_be_returned %}
                                <tr data-title="{{ out.book.BookTitle }}" data-author="{{ out.book.Author }}">
                                    <td>{{out.requested_by}}</td>
                                    <td>{{ out.book.BookTitle }}</td>
                                    <td>{{ out.book.Author }}</td>
                                    <td>{{ out.returnTime }}</td>
                                    <td>
                                        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#statusModal{{ out.id }}">
                                            TO RETURN
                                        </button>
                                        <button type="button" class="btn btn-info" onclick="viewBookDetails('{{ out.book.BookImage.url }}', '{{ out.book.BookTitle }}', '{{ out.book.Description }}')">View</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!--Return logs-->
                    <div class="tab-pane fade" id="logs" role="tabpanel" aria-labelledby="logs-tab">
                        <div class="return-logs">
                            {% if return_logs %}
                            <table class="table" id="logsTable">
                                <thead>
                                    <tr>
                                        <th>Borrowed by</th>
                                        <th>Title</th>
                                        <th>Date Returned</th>
                                        <th>Log Expiry</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for log in return_logs %}
                                    <tr data-title="{{ log.book.BookTitle }}">
                                        <td>{{ log.requested_by }}</td>
                                        <td>{{ log.book.BookTitle }}</td>
                                        <td>{{ log.returnLogTime }}</td>
                                        <td>{{ log.expiryLogTime }}</td>
                                        <td>
                                            <button type="button" class="btn btn-info" onclick="viewBookDetails('{{ log.book.BookImage.url }}', '{{ log.book.BookTitle }}', '{{ log.book.Description }}')">View</button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% else %}
                            <p>No Recent Logs</p>
                            {% endif %}
                        </div>
                    </div>
                
            
                    <!-- Modals for Changing Status -->
                    {% for request in book_status_approved_requests %}
                    <div class="modal fade" id="statusModal{{ request.id }}" tabindex="-1" role="dialog" aria-labelledby="statusModalLabel{{ request.id }}" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="statusModalLabel{{ request.id }}">Book claimed?</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    Are you sure the book is claimed?<b>This action cannot be reversed</b>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                                    <form method="post" action="{% url 'toggle_book_status' request.id %}">
                                        {% csrf_token %}
                                        <button type="submit" class="btn {% if request.inOut %}btn-success{% else %}btn-success{% endif %}">
                                            {% if request.inOut %}Yes{% endif %}
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
            
                    {% for out in book_status_books_to_be_returned %}
                    <div class="modal fade" id="statusModal{{ out.id }}" tabindex="-1" role="dialog" aria-labelledby="statusModalLabel{{ out.id }}" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="statusModalLabel{{ out.id }}">Book Returned?</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    Are you sure the book is returned?<b>This action cannot be reversed</b>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                                    <form method="post" action="{% url 'toggle_out_status' out.id %}">
                                        {% csrf_token %}
                                        <button type="submit" class="btn {% if out.out %}btn-success{% else %}btn-success{% endif %}">
                                            {% if out.out %}Yes{% endif %}
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <script>
                function filterRequests() {
                    // Get the search input and the active tab
                    const input = document.getElementById('searchRequests').value.toLowerCase();
                    const activeTab = document.querySelector('.tab-pane.show.active').id;
                    let table;
            
                    // Determine which table to filter based on the active tab
                    if (activeTab === 'borrowed') {
                        table = document.querySelectorAll('#borrowedTable tbody tr');
                    } else if (activeTab === 'returned') {
                        table = document.querySelectorAll('#returnedTable tbody tr');
                    } else if (activeTab === 'logs') {
                        table = document.querySelectorAll('#logsTable tbody tr');
                    }
            
                    // Filter the rows in the determined table
                    table.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(input) ? '' : 'none';
                    });
                }
            
                // Add an event listener for the search input
                document.getElementById('searchRequests').addEventListener('keyup', filterRequests);
            
                function showBookStatusTab(event, tabId, tabText) {
                    event.preventDefault();
                    // Hide all tab panes
                    document.querySelectorAll('.tab-pane').forEach(tab => {
                        tab.classList.remove('show', 'active');
                    });
                    // Show the selected tab pane
                    document.getElementById(tabId).classList.add('show', 'active');
                    // Update the search placeholder based on the selected tab
                    const searchInput = document.getElementById('searchRequests');
                    if (tabId === 'borrowed') {
                        searchInput.placeholder = 'Search Books to be Borrowed';
                    } else if (tabId === 'returned') {
                        searchInput.placeholder = 'Search Books to be Returned';
                    } else if (tabId === 'logs') {
                        searchInput.placeholder = 'Search Logs';
                    }
                    // Update the dropdown button text
                    document.getElementById('bookStatusDropdown').textContent = tabText;
                }
            
                // Set default tab and dropdown text on page load
                document.addEventListener('DOMContentLoaded', function() {
                    showBookStatusTab(new Event('DOMContentLoaded'), 'borrowed', 'Books to be Borrowed');
                });
            </script>

            <!-- Modal for Viewing Book Details -->
            <div class="modal fade" id="viewBookModal" tabindex="-1" role="dialog" aria-labelledby="viewBookModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="viewBookModalLabel">Book Details</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <img id="viewBookImage" src="" alt="Book Image" class="img-fluid mb-3">
                            <h5 id="viewBookTitle"></h5>
                            <p id="viewBookDescription"></p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Archive -->

            <div id="recent-delete" class="content book-section" style="display: none;">
                <div class="header-lib">
                    <h1 class="mt-4">Archived Books</h1>
                    <div>
                        <form id="deleteAllFormRecentDel" method="post" action="{% url 'delete_all_recently_deleted_books' %}">
                            {% csrf_token %}
                            <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteAllRecentDel">
                                <i class="fas fa-trash-alt"></i> <!-- Trash icon for delete all -->
                            </button>
                        </form>
                    </div>
                </div>
                <hr>
                <table class="table table-bordered table-striped" style="width: 100%; text-align: center;">
                    <thead class="thead-light">
                        <tr>
                            <th>Title</th>
                            <th>Author</th>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Sub-Category</th>
                            <th>Language</th>
                            <th>File Type</th>
                            <th>Stock</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if books %}
                            {% for book in recently_deleted_books %}
                                <tr>
                                    <td class="over-flow">{{ book.BookTitle }}</td>
                                    <td>{{ book.Author }}</td>
                                    <td>{{ book.Date }}</td>
                                    <td>
                                        {% for category in book.Category.all %}
                                            {{ category.name }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </td>
                                    <td>
                                        {% for subcategory in book.SubCategory.all %}
                                            {{ subcategory.name }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </td>
                                    <td>{{ book.Language }}</td>
                                    <td>{{ book.get_file_type }}</td>
                                    <td>{{ book.stock }}</td>
                                    <td>
                                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#viewBookModal-{{ book.id }}">
                                            <i class="fas fa-eye"></i> <!-- Eye icon for viewing -->
                                        </button>
                                        <form id="restoreFormRecentDel-{{ book.id }}" method="post" action="{% url 'restore_book' book.id %}" style="display: inline;">
                                            {% csrf_token %}
                                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#restoreModalRecentDel" data-bookid="{{ book.id }}" title="Restore Book">
                                                <i class="fas fa-undo"></i> <!-- Undo icon for restore -->
                                            </button>
                                        <form id="deleteFormBook-{{ book.id }}" method="post" action="{% url 'delete_book' book.id %}" style="display: inline;">
                                            {% csrf_token %}
                                            <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteModalRecentDel" data-bookid="{{ book.id }}" title="Delete Book">
                                                <i class="fas fa-trash"></i> <!-- Trash icon for delete -->
                                            </button>
                                        </form>
                                    </td>
                                </tr>

                                <!-- Modal for Viewing Book Details -->
                                <div class="modal fade" id="viewBookModal-{{ book.id }}" tabindex="-1" role="dialog" aria-labelledby="viewBookModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-lg" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="viewBookModalLabel">{{ book.BookTitle }}</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row">
                                                    <!-- Book Image on the left side with larger size -->
                                                    <div class="col-md-5 d-flex align-items-center justify-content-center">
                                                        {% if book.BookImage %}
                                                            <img src="{{ book.BookImage.url }}" alt="{{ book.BookTitle }} Image" class="img-fluid" style="max-width: 100%; height: auto; max-height: 400px; object-fit: cover;">
                                                        {% else %}
                                                            <p>No image available</p>
                                                        {% endif %}
                                                    </div>
                                                    <!-- Book Details on the right side -->
                                                    <div class="col-md-7">
                                                        <div class="book-details">
                                                            <p><strong>Author:</strong> {{ book.Author }}</p>
                                                            <p><strong>Date:</strong> {{ book.Date }}</p>
                                                            <p><strong>Description:</strong> {{ book.Description }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="9">No books found.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            <!-- Restore Confirmation Modal -->
            <div class="modal fade" id="restoreModalRecentDel" tabindex="-1" aria-labelledby="restoreModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="restoreModalLabel">Confirm Restore</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to restore this book?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="confirmRestoreBtnRecentDel">Restore</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Modal for Delete All for Recently Deleted -->
            <div class="modal fade" id="deleteAllRecentDel" tabindex="-1" aria-labelledby="deleteAllModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="deleteAllModalLabel">Delete All Books</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to delete all books?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <form id="deleteAllFormRecentDel" method="post" action="{% url 'delete_all_recently_deleted_books' %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger">
                                    <i class="fas fa-trash-alt"></i> Delete All <!-- Trash icon for delete all -->
                                </button>
                            </form>                
                        </div>
                    </div>
                </div>
            </div>
                
            <!-- Modal for Delete Books -->
            <div class="modal fade" id="deleteModalRecentDel" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="deleteModalLabel">Delete Book</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to delete this book?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-danger" id="confirmDeleteBtnRecentDel">
                                <i class="fas fa-trash"></i> Delete <!-- Trash icon for delete -->
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="borrow-req" class="content" style="display: none;">
                <h2 class="sections">Borrow Requests</h2>
                {% if messages %}
                {% for message in messages %}
                    {% if message.tags == 'success' %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    {% elif message.tags == 'error' %}
                        <div class="alert alert-danger">
                            <ul class="mb-0">
                                <li>{{ message }}</li>
                            </ul>
                        </div>
                    {% endif %}
                {% endfor %}
                {% endif %}
                <!-- Dropdown and Search Field in the Same Row -->
                <div class="d-flex align-items-center mb-3">
                    <!-- Dropdown for Borrow Requests -->
                    <div class="dropdown mr-2">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="borrowRequestDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Pending Requests
                        </button>
                        <div class="dropdown-menu" aria-labelledby="borrowRequestDropdown">
                            <a class="dropdown-item active" href="#" onclick="selectTab('pending', 'Pending Requests'); return false;">Pending Requests</a>
                            <a class="dropdown-item" href="#" onclick="selectTab('approved', 'Approved Requests'); return false;">Approved Requests</a>
                            <a class="dropdown-item" href="#" onclick="selectTab('declined', 'Declined Requests'); return false;">Declined Requests</a>
                        </div>
                    </div>
            
                    <!-- Search Field -->
                    <div class="input-group">
                        <input type="text" class="form-control" id="requestsSearch" placeholder="Search Requests" onkeyup="fetchRequests()">
                        <div class="input-group-append">
                            <span class="input-group-text" id="search-addon"><i class="fas fa-search"></i></span>
                        </div>
                    </div>
                </div>
            
                <!-- Tab Content -->
                <div class="tab-content" id="borrowRequestTabContent">
                    <!-- Pending Requests Tab -->
                    <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
                        <hr>
                        <div id="pendingRequestsContainer">
                            <!-- Pending requests will be dynamically inserted here -->
                        </div>
                    </div>
            
                    <!-- Approved Requests Tab -->
                    <div class="tab-pane fade" id="approved" role="tabpanel" aria-labelledby="approved-tab">
                        <hr>
                        <div id="approvedRequestsContainer">
                            <!-- Approved requests will be dynamically inserted here -->
                        </div>
                    </div>
            
                    <!-- Declined Requests Tab -->
                    <div class="tab-pane fade" id="declined" role="tabpanel" aria-labelledby="declined-tab">
                        <hr>
                        <div id="declinedRequestsContainer">
                            <!-- Declined requests will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        </main>
    </div>



    <script>
        async function fetchBorrowRequests() {
            try {
                const response = await fetch('/librarian/api/borrow-requests/');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                updateRequests('pendingRequestsContainer', data.borrow_requests, false);
                updateRequests('approvedRequestsContainer', data.approved_requests, 'approved');
                updateRequests('declinedRequestsContainer', data.declined_requests, 'declined');
            } catch (error) {
                console.error('Error fetching borrow requests:', error);
            }
        }
    
        function updateRequests(containerId, requests, requestType = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
    
            if (requests.length === 0) {
                container.innerHTML = '<div class="alert alert-warning">No requests at the moment.</div>';
                return;
            }
    
            const table = document.createElement('table');
            table.className = 'table table-striped';
            const thead = document.createElement('thead');
            thead.className = 'thead-light';
            const tbody = document.createElement('tbody');
    
            const headers = ['Book', 'Requested By', 'Requested At', 'Expires At', 'File Type', 'Action'];
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
    
            requests.forEach(request => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${request.book_title}</td>
                    <td>${request.requested_by_name}</td>
                    <td>${request.requested_at}</td>
                    <td>${request.expires_at}</td>
                    <td>${request.file_type}</td>
                    <td>
                        ${!requestType ? `
                        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#approveModal${request.id}">Approve</button>
                        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#declineModal${request.id}">Decline</button>
                        ` : ''}
                        ${requestType === 'approved' ? `<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteApprovedModal${request.id}">Delete</button>` : ''}
                        ${requestType === 'declined' ? `<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteDeclinedModal${request.id}">Delete</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
    
                // Append modals for approve and decline actions if not requestType
                if (!requestType) {
                    document.body.insertAdjacentHTML('beforeend', `
                        <div class="modal fade" id="approveModal${request.id}" tabindex="-1" role="dialog" aria-labelledby="approveModalLabel${request.id}" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="approveModalLabel${request.id}"><b>Approve Request?</b></h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Are you sure you want to approve this request?
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                        <form method="post" action="/librarian/borrow_requests/approve/${request.id}/">
                                            <input type="hidden" name="csrfmiddlewaretoken" value="${getCsrfToken()}">
                                            <button type="submit" class="btn btn-success">Approve</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
    
                        <div class="modal fade" id="declineModal${request.id}" tabindex="-1" role="dialog" aria-labelledby="declineModalLabel${request.id}" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="declineModalLabel${request.id}"><b>Decline Request?</b></h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <p>This action cannot be reversed</p>
                                        <hr>
                                        <!-- Dropdown for selecting the reason for declining -->
                                        <div class="form-group">
                                            <label for="declineReason${request.id}">Select a reason for declining:</label>
                                            <select class="form-control" id="declineReason${request.id}" name="decline_reason" required>
                                                <option value="" disabled selected>Select a reason</option>
                                                <option value="out_of_stock">Out of Stock</option>
                                                <option value="book_not_available">Book Not Available</option>
                                                <option value="invalid_request">Invalid Request</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                        <form method="post" action="/librarian/borrow_requests/decline/${request.id}/">
                                            <input type="hidden" name="csrfmiddlewaretoken" value="${getCsrfToken()}">
                                            <input type="hidden" id="declineReasonInput${request.id}" name="decline_reason_input">
                                            <button type="submit" class="btn btn-danger" 
                                                    onclick="document.getElementById('declineReasonInput${request.id}').value = document.getElementById('declineReason${request.id}').value;">
                                                Decline
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `);
                }
    
                // Append delete modal for approved requests
                if (requestType === 'approved') {
                    document.body.insertAdjacentHTML('beforeend', `
                        <div class="modal fade" id="deleteApprovedModal${request.id}" tabindex="-1" role="dialog" aria-labelledby="deleteApprovedModalLabel${request.id}" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="deleteApprovedModalLabel${request.id}">Delete Approved Request?</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        This action cannot be reversed
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                        <form method="post" action="/librarian/delete_approved_request/${request.id}/">
                                            <input type="hidden" name="csrfmiddlewaretoken" value="${getCsrfToken()}">
                                            <button type="submit" class="btn btn-danger">Delete</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `);
                }
    
                // Append delete modal for declined requests
                if (requestType === 'declined') {
                    document.body.insertAdjacentHTML('beforeend', `
                        <div class="modal fade" id="deleteDeclinedModal${request.id}" tabindex="-1" role="dialog" aria-labelledby="deleteDeclinedModalLabel${request.id}" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="deleteDeclinedModalLabel${request.id}">Delete Declined Request</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Are you sure you want to delete this declined request?
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                        <form method="post" action="/librarian/delete_declined_request/${request.id}/">
                                            <input type="hidden" name="csrfmiddlewaretoken" value="${getCsrfToken()}">
                                            <button type="submit" class="btn btn-danger">Delete</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `);
                }
            });
    
            table.appendChild(thead);
            table.appendChild(tbody);
            container.appendChild(table);
        }
    
        function getCsrfToken() {
            return document.querySelector('[name=csrfmiddlewaretoken]').value;
        }
    
        function fetchRequests() {
            // Get the search input and the active tab
            const input = document.getElementById('requestsSearch').value.toLowerCase();
            const activeTab = document.querySelector('.tab-pane.show.active').id;
            let table;
    
            // Determine which table to filter based on the active tab
            if (activeTab === 'pending') {
                table = document.querySelectorAll('#pendingRequestsContainer tr');
            } else if (activeTab === 'approved') {
                table = document.querySelectorAll('#approvedRequestsContainer tr');
            } else if (activeTab === 'declined') {
                table = document.querySelectorAll('#declinedRequestsContainer tr');
            }
    
            // Filter the rows in the determined table
            table.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(input) ? '' : 'none';
            });
        }
    
        function selectTab(tabId, tabName) {
            document.querySelectorAll('.tab-pane').forEach(tab => {
                tab.classList.remove('show', 'active');
            });
            document.getElementById(tabId).classList.add('show', 'active');
    
            document.querySelectorAll('.input-group input').forEach(input => {
                input.style.display = 'none';
            });
            document.getElementById(`requestsSearch`).style.display = 'block';
        }
    
        // Fetch borrow requests every 10 seconds
        setInterval(fetchBorrowRequests, 10000);
    
        // Initial fetch
        fetchBorrowRequests();
    </script>

 <!-- jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    function showTab(event, tabId) {
        event.preventDefault();
    
        // Hide all tab content
        $('.tab-pane').removeClass('show active').addClass('hidden');
    
        // Remove active classes from all tabs
        $('#bookStatusTabs a').removeClass('text-blue-600 border-blue-600 active')
                              .addClass('text-gray-600 border-transparent');
    
        // Show the selected tab content
        $('#' + tabId).removeClass('hidden').addClass('show active');
    
        // Add active class to the selected tab
        $(event.currentTarget).addClass('border-blue-600 active')
                              .removeClass('border-transparent');
        
        // Update search placeholder based on active tab
        const tabText = $(event.currentTarget).text();
        $('#searchRequests').attr('placeholder', 'Search ' + tabText);
        $('#searchRequests').val(''); // Clear search input
        filterRequests(); // Reset the filter for the current tab
    }

    function filterRequests() {
        // Get the search input and the active tab
        const input = $('#searchRequests').val().toLowerCase();
        const activeTab = $('.tab-pane.show.active').attr('id');
        let table;

        // Determine which table to filter based on the active tab
        if (activeTab === 'borrowed') {
            table = $('#borrowedTable tr');
        } else if (activeTab === 'returned') {
            table = $('#returnedTable tr');
        } else if (activeTab === 'logs') {
            table = $('#logsTable tr');
        }

        // Filter the rows in the determined table, skipping the header row
        table.each(function(index) {
            if (index === 0) return; // Skip the header row
            const row = $(this);
            const text = row.text().toLowerCase();
            if (text.includes(input)) {
                row.show();
            } else {
                row.hide();
            }
        });
    }

    // Add an event listener for the search input
    $('#searchRequests').on('keyup', filterRequests);

    // Function to view book details
    function viewBookDetails(imageUrl, title, description) {
        $('#viewBookImage').attr('src', imageUrl);
        $('#viewBookTitle').text(title);
        $('#viewBookDescription').text(description);
        $('#viewBookModal').modal('show');
    }

    function selectTab(tabId, tabText) {
        // Hide all tab content
        $('.tab-pane').removeClass('show active');
        // Show selected tab
        $('#' + tabId).addClass('show active');
        // Update dropdown button text
        $('#borrowRequestDropdown').text(tabText);
        // Update search placeholder based on selected tab
        $('#searchRequests').attr('placeholder', 'Search ' + tabText);
        // Clear search input
        $('#searchRequests').val('');
        // Reset the filter for the current tab
        filterRequests();
    }
    
    function filterRequests() {
        // Get the search input and the active tab
        const input = $('#searchRequests').val().toLowerCase();
        const activeTab = $('.tab-pane.show').attr('id');
        let table;
    
        // Determine which table to filter based on the active tab
        if (activeTab === 'pending') {
            table = $('#pendingTable tr');
        } else if (activeTab === 'approved') {
            table = $('#approvedTable tr');
        } else if (activeTab === 'declined') {
            table = $('#declinedTable tr');
        }
    
        // Filter the rows in the determined table
        table.each(function() {
            const row = $(this);
            const text = row.text().toLowerCase();
            if (text.includes(input)) {
                row.show();
            } else {
                row.hide();
            }
        });
    }
    
    // Add an event listener for the search input
    $('#searchRequests').on('keyup', filterRequests);
    </script>
    



<style>
    .dropdown-item.active {
        background-color: transparent; /* Change to your desired color */
        color: #000; /* Change text color if needed */
    }
    .dropdown-item:focus, .dropdown-item:hover {
        background-color: transparent; /* Change to your desired hover color */
        color: #000; /* Change hover text color if needed */
    }
</style>


<!-- Include jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>



<script>
    $(document).ready(function() {
        $('#id_Category').change(function() {
            var selectedCategoryId = $(this).val();
            $('#id_Subcategories option').each(function() {
                var subcategoryCategoryId = $(this).data('category-id');
                if (subcategoryCategoryId == selectedCategoryId || !selectedCategoryId) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
            $('#id_Subcategories').val(''); // Reset subcategory selection
            $('#id_Subsection').val(''); // Reset subsection selection
            $('#id_Subsection option').hide(); // Hide all subsections initially
        });
    
        $('#id_Subcategories').change(function() {
            var selectedSubCategoryId = $(this).val();
            $('#id_Subsection option').each(function() {
                var subsectionSubCategoryId = $(this).data('section-id');
                if (subsectionSubCategoryId == selectedSubCategoryId || !selectedSubCategoryId) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
            $('#id_Subsection').val(''); // Reset subsection selection
        });
    });

    
    let noOfCharac = 150;
    let contents = document.querySelectorAll(".book-description");
    contents.forEach(content => {
            let displayText = content.textContent.slice(0, noOfCharac);
            let moreText = content.textContent.slice(noOfCharac);
            if(content.textContent.length > noOfCharac){
                content.innerHTML = `${displayText}<span class="dots">...</span><span class="hide more">${moreText}</span>`;
            }
    });

    function readMore(btn) {
        // Find the parent row <tr> of the button clicked
        let row = btn.closest('tr');

        // Toggle visibility of the new content row and current row
        if (btn.textContent === "More Info") {
            // Hide the current row
            row.style.display = 'none';

            // Create a new <tr> to insert after the current one
            let newRow = document.createElement('tr');
            newRow.classList.add('new-row');

            // Insert new HTML content inside the new row
            newRow.innerHTML = `
                <td colspan="11">
                    <div class="info-container pt-4">
                        <div class="read-more-body row">
                            <div class="read-more-bookInfo col-5">
                                <div>
                                    <div class="center-item row">
                                        <dt class="fs-3">${row.querySelector(".over-flow").textContent}</dt>
                                    </div>
                                    <div class="center-item row">
                                        <span class="fs-5">${row.children[1].textContent}</span>
                                    </div>
                                    <div class="center-item row">
                                        <img src="${row.querySelector('.lib-img') ? row.querySelector('.lib-img').src : ''}" class="lib-img">
                                    </div>
                                </div>
                            </div>
                            <div class="col" style="padding-top: 80px; padding-right: 50px; text-align: justify;">
                                <div class="row">
                                    <dt class="center-item mb-3" style="font-size: 1.2rem;">Description</dt>
                                    <p style="font-size: .8rem;">${row.querySelector(".book-description").textContent}</p>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <dt class="center-item">Category</dt>
                                        <span class="center-item">${row.children[4].textContent}</span>
                                    </div>
                                    <div class="col">
                                        <dt class="center-item">SubCategory</dt>
                                        <span class="center-item" style="font-size:.8rem;">${row.children[5].textContent}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-5">
                            <div class="col">
                                <dt class="d-flex justify-content-center row">stock</dt>
                                <p class="d-flex justify-content-center row">${row.children[9].textContent}</p>
                            </div>
                            <div class="col">
                                <dt class="d-flex justify-content-center row">file type</dt>
                                <p class="d-flex justify-content-center row">${row.children[8].textContent}</p>
                            </div>
                            <div class="col">
                                <dt class="d-flex justify-content-center row">language</dt>
                                <p class="d-flex justify-content-center row">${row.children[6].textContent}</p>
                            </div>
                            <div class="col-2">
                                <dt class="d-flex justify-content-center">actions</dt>
                                <div class="row restore-delete">
                                    ${row.querySelector(".more-info-btn").innerHTML}
                                    ${row.querySelector(".more-info-btn2").innerHTML}
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-danger" onclick="readLess(this)">Less Info</button>
                </td>
            `;

            // Insert the new row after the current row
            row.parentNode.insertBefore(newRow, row.nextSibling);

        } else {
            // Remove the new row and show the original one
            let newRow = row.nextElementSibling;
            if (newRow && newRow.classList.contains('new-row')) {
                newRow.remove();  // Remove the new row
            }
            row.style.display = '';  // Show the original row
            btn.textContent = "More Info";  // Reset the button text
        }
    }

    function readLess(btn) {
        let newRow = btn.closest('tr');
        let originalRow = newRow.previousElementSibling;

        // Remove the new row and show the original row
        newRow.remove();
        originalRow.style.display = '';
        originalRow.querySelector('.read-btn').textContent = "More Info";
    }


    function showContent(contentId) {
        var contents = document.getElementsByClassName('content');
        for (var i = 0; i < contents.length; i++) {
            contents[i].style.display = 'none';
        }
        document.getElementById(contentId).style.display = 'block';
        localStorage.setItem('activeContent', contentId);
    }

    window.onload = function() {
        var activeContent = localStorage.getItem('activeContent') || 'home';
        
        // Check if there's a URL hash to load the correct tab
        if (window.location.hash) {
            activeContent = window.location.hash.substring(1); // Get hash without '#'
        }
    
        showContent(activeContent);
    
        // Hide all sections (optional, if you have other content management logic)
        document.querySelectorAll('.content-section').forEach(function(section) {
            section.style.display = 'none';
        });
    
        // Show the selected section
        document.getElementById(activeContent).style.display = 'block';
    };
    function setDeleteUrl(bookId) {
        var bookRow = document.getElementById('bookRow-' + bookId);
        bookRow.style.display = 'none';

        var deletedBookRow = document.getElementById('deletedBookRow-' + bookId);
        deletedBookRow.style.display = 'table-row';
    }

    function deleteAllBooks() {
        var bookRows = document.getElementsByClassName('bookRow');
        for (var i = 0; i < bookRows.length; i++) {
            bookRows[i].style.display = 'none';
        }

        var deletedBookRows = document.getElementsByClassName('deletedBookRow');
        for (var i = 0; i < deletedBookRows.length; i++) {
            deletedBookRows[i].style.display = 'table-row';
        }

        showDeletedBooks();
    }

    function confirmDeleteBookSection(bookId) {
        if (confirm('Are you sure you want to delete this book?')) {
            document.getElementById('deleteForm-' + bookId).submit();
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const ebookCheckbox = document.getElementById('id_eBook');
        const researchPaperCheckbox = document.getElementById('id_research_paper');

        ebookCheckbox.addEventListener('change', function() {
            if (ebookCheckbox.checked) {
                researchPaperCheckbox.checked = false;
            }
        });

        researchPaperCheckbox.addEventListener('change', function() {
            if (researchPaperCheckbox.checked) {
                ebookCheckbox.checked = false;
            }
        });
    });

    function toggleAvailability(bookId) {
        var availabilityBtn = document.getElementById('availabilityBtn-' + bookId);
        var isAvailable = availabilityBtn.classList.contains('btn-success');
        var newAvailability = isAvailable ? 'false' : 'true';

        $.ajax({
            url: '{% url "toggle_availability" 0 %}'.replace('0', bookId),
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'book_id': bookId,
                'available': newAvailability
            },
            success: function(response) {
                if (response.success) {
                    if (newAvailability === 'true') {
                        availabilityBtn.innerHTML = 'Available';
                        availabilityBtn.classList.remove('btn-danger');
                        availabilityBtn.classList.add('btn-success');
                    } else {
                        availabilityBtn.innerHTML = 'Not Available';
                        availabilityBtn.classList.remove('btn-success');
                        availabilityBtn.classList.add('btn-danger');
                    }
                } else {
                    console.log('Error toggling availability');
                }
            },
            error: function(xhr, status, error) {
                console.log('Error toggling availability:', error);
            }
        });
    }

    function confirmDeleteAll() {
        $('#deleteAllModal').modal('show');
    }

    function deleteAllBooks() {
        document.getElementById("deleteAllForm").submit();
    }

    $(document).ready(function() {
        $('#deleteModalBook').on('show.bs.modal', function(event) {
            var button = $(event.relatedTarget);
            var bookId = button.data('bookid');
            var modal = $(this);
            modal.find('#confirmDeleteBtnBook').attr('onclick', 'submitDeleteForm(' + bookId + ')');
        });

        $('#deleteModalRecentDel').on('show.bs.modal', function(event) {
            var button = $(event.relatedTarget);
            var bookId = button.data('bookid');
            var modal = $(this);
            modal.find('#confirmDeleteBtnRecentDel').click(function() {
                $('#deleteFormRecentDel-' + bookId).submit();
            });
        });

        $('#restoreModalRecentDel').on('show.bs.modal', function(event) {
            var button = $(event.relatedTarget);
            var bookId = button.data('bookid');
            var modal = $(this);
            modal.find('#confirmRestoreBtnRecentDel').click(function() {
                $('#restoreFormRecentDel-' + bookId).submit();
            });
        });
    });

    function submitDeleteForm(bookId) {
        var form = $('#deleteFormBook-' + bookId);
        form.submit();
    }

    function submitRestoreForm(bookId) {
        var form = $('#deleteFormBook-' + bookId);
        form.submit();
    }

    document.addEventListener('DOMContentLoaded', function() {
        const buttons = document.querySelectorAll('.availabilityBtn');
        buttons.forEach(button => {
            button.addEventListener('click', function(event) {
                event.preventDefault();
                const id = this.getAttribute('data-id');
                const status = this.getAttribute('data-status') === 'true';
                const type = this.getAttribute('data-type');
                openModal(id, status, type);
            });
        });
    });

    function openModal(id, status, type) {
        const modal = document.getElementById('statusModal');
        const modalBody = document.getElementById('modalBody');

        let actionUrl, buttonClass, buttonText, questionText;
        if (type === 'request') {
            actionUrl = `{% url 'toggle_book_status' 0 %}`.replace('0', id);
            buttonClass = status ? 'btn-success' : 'btn-success';
            buttonText = status ? 'In' : 'Yes';
            questionText = 'Are you sure you want to change the status of this book?';
        } else if (type === 'out') {
            actionUrl = `{% url 'toggle_out_status' 0 %}`.replace('0', id);
            buttonClass = status ? 'btn-danger' : 'btn-success';
            buttonText = status ? 'Out' : 'Yes';
            questionText = 'Are you sure that this book is returned?';
        }

        const content = `
            <p>${questionText}</p>
            <form id="toggleForm-${id}" method="post" action="${actionUrl}" style="display: inline;">
                {% csrf_token %}
                <button id="availabilityBtn-${id}" class="btn ${buttonClass}">
                    ${buttonText}
                </button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </form>
        `;

        modalBody.innerHTML = content;
        modal.style.display = 'block';
    }

    function closeModal() {
        const modal = document.getElementById('statusModal');
        modal.style.display = 'none';
    }

    window.onclick = function(event) {
        const modal = document.getElementById('statusModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    };

</script>

<script>
    // Function to send an AJAX request to keep the session alive
    function keepSessionAlive() {
        fetch("{% url 'keep_session_alive' %}", {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        }).then(response => response.json())
          .then(data => {
              console.log('Session kept alive:', data);
          }).catch(error => {
              console.error('Error keeping session alive:', error);
          });
    }

    // Event listener to keep the session alive on every mouse click
    document.addEventListener('click', keepSessionAlive);
    document.addEventListener('keypress', keepSessionAlive);

    // Optionally, you can still send an AJAX request periodically
    setInterval(keepSessionAlive, 300000);



    
</script>


</body>
</html>
{% endif %}
