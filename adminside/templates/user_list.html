<div id="analytics-section">
    <h2>User List</h2>

    <!-- Filters Row -->
    <div class="row mb-3">
        <div class="col-md-2">
            <label for="role-filter" class="form-label">Filter by Role:</label>
            <select id="role-filter" class="form-select">
                <option value="">All Roles</option>
                <option value="Student">Student</option>
                <option value="Librarian">Librarian</option>
            </select>
        </div>

        <div class="col-md-10">
            <label for="search-input1" class="form-label">Search by Username:</label>
            <input type="text" id="search-input1" class="form-control" placeholder="Search for usernames..">
        </div>
    </div>

    <!-- User List Table -->
    <div class="table-responsive">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Active</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="user-list-tbody">
                {% for user in users %}
                <tr id="user-row-{{ user.id }}">
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.first_name }}, {{ user.last_name }}</td>
                    <td>
                        {% for group in user.groups.all %}
                            {{ group.name }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    </td>
                    <td id="user-status-{{ user.id }}">{{ user.is_active }}</td>
                    <td>
                        <button 
                            class="btn {% if user.is_active %}btn-danger{% else %}btn-success{% endif %}" 
                            data-bs-toggle="modal" 
                            data-bs-target="#confirmDisableModal" 
                            data-user-id="{{ user.id }}" 
                            data-user-status="{{ user.is_active }}">
                            {% if user.is_active %}Disable{% else %}Activate{% endif %}
                        </button>
                        <button 
                            class="btn btn-primary" 
                            data-bs-toggle="modal" 
                            data-user-id="{{ user.id }}">
                            Key
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modals -->
<!-- Loading Spinner Modal -->
<div class="modal fade" id="loadingSpinnerModal" tabindex="-1" role="dialog" aria-labelledby="loadingSpinnerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only"></span>
                </div>
                <p>Please wait...</p>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body text-center">
                <p id="successModalMessage"></p>
            </div>
        </div>
    </div>
</div>

<!-- Key Modal -->
<div class="modal fade" id="keyModal" tabindex="-1" role="dialog" aria-labelledby="keyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body text-center">
                <p>New Password: <span id="newPassword"></span></p>
            </div>
        </div>
    </div>
</div>

<!-- Confirm Key Modal -->
<div class="modal fade" id="confirmKeyModal" tabindex="-1" role="dialog" aria-labelledby="confirmKeyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body text-center">
                <p>Are you sure you want to reset the password?</p>
                <button type="button" class="btn btn-danger" id="confirmKeyAction">Yes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirm Disable Modal -->
<div class="modal fade" id="confirmDisableModal" tabindex="-1" aria-labelledby="confirmDisableModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDisableModalLabel">Confirm Action</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to <span id="action-text">disable</span> this account?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                <button type="button" class="btn btn-primary" id="confirmAction">Yes</button>
            </div>
        </div>
    </div>
</div>

<!-- Include jQuery and Bootstrap JS for handling the modal -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Include Bootstrap Bundle (includes Bootstrap JS and Popper.js) -->